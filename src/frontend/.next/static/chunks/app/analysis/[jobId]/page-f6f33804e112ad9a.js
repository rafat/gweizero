(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[266],{791:(e,t,s)=>{"use strict";s.d(t,{Iw:()=>n,TQ:()=>c,YF:()=>l,pH:()=>i,qi:()=>r});let a="http://127.0.0.1:3001";async function n(e){let t=await fetch(`${a}/api/analyze/jobs`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})});if(!t.ok){let e=await t.text();throw Error(`Failed to create analysis job (${t.status}): ${e}`)}return t.json()}async function r(e){let t=await fetch(`${a}/api/analyze/jobs/${e}`,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-store"});if(!t.ok){let e=await t.text();throw Error(`Failed to fetch analysis job (${t.status}): ${e}`)}return t.json()}async function l(e){let t=await fetch(`${a}/api/analyze/jobs/${e}/cancel`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok){let e=await t.text();throw Error(`Failed to cancel analysis job (${t.status}): ${e}`)}return t.json()}function i(e){return`${a}/api/analyze/jobs/${e}/events`}function c(e){return"completed"===e||"failed"===e||"cancelled"===e}},1951:(e,t,s)=>{"use strict";s.d(t,{cn:()=>r});var a=s(9722),n=s(622);function r(...e){return(0,n.QP)((0,a.$)(e))}},3914:(e,t,s)=>{"use strict";s.d(t,{AnalysisJobHud:()=>c});var a=s(5155),n=s(2115),r=s(4474),l=s(791);let i=[{key:"queued",label:"Queued"},{key:"static_analysis",label:"Static Analysis"},{key:"dynamic_analysis",label:"Dynamic Analysis"},{key:"ai_optimization",label:"AI Optimization"},{key:"completed",label:"Complete"}];function c({jobId:e}){let[t,s]=(0,n.useState)(null),[c,o]=(0,n.useState)(null),[d,u]=(0,n.useState)("initializing"),[m,p]=(0,n.useState)([]),[x,b]=(0,n.useState)(!1),h=(0,n.useRef)(null),f=(0,n.useRef)(null),y=t?.status??"queued",j=(0,l.TQ)(y),g=(0,n.useMemo)(()=>{let e=t?.events??[];if(!m.length)return e;let s=[...e,...m];return s.sort((e,t)=>e.timestamp-t.timestamp),s},[t?.events,m]),N=(0,n.useCallback)(async()=>{try{let t=await (0,l.qi)(e);return s(t),t}catch(e){return o(e instanceof Error?e.message:"Failed to fetch job."),null}},[e]),v=(0,n.useCallback)(()=>{f.current&&(clearInterval(f.current),f.current=null)},[]),w=(0,n.useCallback)(()=>{f.current||(u("polling"),f.current=setInterval(async()=>{let e=await N();e&&(0,l.TQ)(e.status)&&v()},2500))},[N,v]),k=(0,n.useCallback)(()=>{h.current&&(h.current.close(),h.current=null)},[]);async function $(){b(!0),o(null);try{let t=await (0,l.YF)(e);s(t),(0,l.TQ)(t.status)&&(k(),v())}catch(e){o(e instanceof Error?e.message:"Failed to cancel job.")}finally{b(!1)}}return(0,n.useEffect)(()=>{let t=!0;return(async()=>{let s=await N();if(!t)return;if(s&&(0,l.TQ)(s.status))return u("polling");let a=new EventSource((0,l.pH)(e));h.current=a,u("sse"),a.addEventListener("progress",e=>{try{let t=JSON.parse(e.data);p(e=>[...e,t])}catch{}}),a.addEventListener("done",async()=>{await N(),k()}),a.onerror=async()=>{k();let e=await N();e&&(0,l.TQ)(e.status)||w()}})(),()=>{t=!1,k(),v()}},[N,e,w,v,k]),(0,a.jsx)("main",{className:"mx-auto min-h-screen w-full max-w-5xl px-6 py-10",children:(0,a.jsxs)("section",{className:"rounded-2xl border border-line bg-surface/70 p-6 backdrop-blur",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-muted",children:"Analysis Job"}),(0,a.jsx)("h1",{className:"mt-1 text-2xl font-semibold",children:e}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-muted",children:["Stream mode: ",(0,a.jsx)("span",{className:"text-text",children:d})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"rounded-full border border-line bg-surface-2 px-3 py-1 text-xs uppercase tracking-wider text-muted",children:y.replaceAll("_"," ")}),!j&&(0,a.jsx)(r.$,{variant:"secondary",onClick:$,disabled:x,children:x?"Cancelling...":"Cancel"})]})]}),(0,a.jsx)("div",{className:"mt-6 grid gap-3 md:grid-cols-5",children:i.map((e,t)=>{let s=i.findIndex(e=>e.key===y)>t||"completed"===y,n=e.key===y,r=("failed"===y||"cancelled"===y)&&n;return(0,a.jsx)("div",{className:`rounded-xl border px-3 py-3 text-center text-xs font-semibold uppercase tracking-wider ${r?"border-danger/80 text-danger":n?"border-accent text-accent shadow-glow":s?"border-success text-success":"border-line text-muted"}`,children:e.label},e.key)})}),t?.result?.optimizationValidation&&(0,a.jsxs)("div",{className:"mt-6 rounded-xl border border-line bg-surface-2 p-4",children:[(0,a.jsx)("p",{className:"text-sm font-semibold",children:"Acceptance Validation"}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-muted",children:["Accepted:"," ",(0,a.jsx)("span",{className:t.result.optimizationValidation.accepted?"text-success":"text-danger",children:t.result.optimizationValidation.accepted?"Yes":"No"})]}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted",children:t.result.optimizationValidation.reason}),"number"==typeof t.result.optimizationAttempts&&(0,a.jsxs)("p",{className:"mt-1 text-sm text-muted",children:["Attempts: ",t.result.optimizationAttempts]})]}),(0,a.jsxs)("div",{className:"mt-6 rounded-xl border border-line bg-surface-2 p-4",children:[(0,a.jsx)("p",{className:"text-sm font-semibold",children:"Live Event Stream"}),(0,a.jsxs)("div",{className:"mt-3 max-h-72 space-y-2 overflow-auto pr-2",children:[0===g.length&&(0,a.jsx)("p",{className:"text-sm text-muted",children:"Waiting for events..."}),g.map((e,t)=>(0,a.jsxs)("div",{className:"rounded-lg border border-line/70 px-3 py-2",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wider text-muted",children:e.phase.replaceAll("_"," ")}),(0,a.jsx)("p",{className:"mt-1 text-sm text-text",children:e.message})]},`${e.timestamp}-${t}`))]})]}),t?.error&&(0,a.jsx)("p",{className:"mt-4 text-sm text-danger",children:t.error}),c&&(0,a.jsx)("p",{className:"mt-4 text-sm text-danger",children:c})]})})}},4366:(e,t,s)=>{Promise.resolve().then(s.bind(s,3914))},4474:(e,t,s)=>{"use strict";s.d(t,{$:()=>r});var a=s(5155),n=s(1951);function r({className:e,variant:t="primary",...s}){return(0,a.jsx)("button",{className:(0,n.cn)("inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium transition","disabled:cursor-not-allowed disabled:opacity-60","primary"===t&&"bg-accent text-black hover:shadow-glow focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent/80","secondary"===t&&"border border-line bg-surface-2 text-text hover:border-accent/40 hover:bg-surface",e),...s})}}},e=>{e.O(0,[409,441,794,358],()=>e(e.s=4366)),_N_E=e.O()}]);